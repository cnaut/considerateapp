<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    
    <title>PhoneGap WP7</title>
    
	  <link rel="stylesheet" href="master.css" type="text/css" media="screen" title="no title" charset="utf-8"/>
            
      <script type="text/javascript" charset="utf-8" src="cordova-1.5.0.js"></script>
     
       
      <script type="text/javascript">

        //timer variables
        var c=0;
        var f=0;
        var t;
        var g;
        var timer_is_on=0;

        //accelerometer variables
        var watchID = null;
        var initial = 0;
        var accX = 0;
        var accY = 0;
        var accZ = 0;
        var valueX;
        var valueY;
        var valueZ;

        function stopWatch() {
        if (watchID) {
        navigator.accelerometer.clearWatch(watchID);
        watchID = null;
        }
        }



        function onSuccess(acceleration) {

        if (initial == 0) {
        console.log("zerooooooooooo");
        accX = acceleration.x;
        accY = acceleration.y;
        accZ = acceleration.z;
        valueX.value = "X: " + acceleration.x;
        valueY.value = "Y: " + acceleration.y;
        valueZ.value = "Z: " + acceleration.z;
        initial = 1;
        } else {
        console.log(accX);
        if (acceleration.x != accX) {
        document.getElementById("accelerometer").innerHTML = "You Lose!";
        stopCount();
        stopWatch();       
        //ADD CODEEEEEE
        }

        }


        }



        //watch acceleration
        function startWatch() {
        valueX = document.getElementById("valueX");
        valueY = document.getElementById("valueY");
        valueZ = document.getElementById("valueZ");
        var options = {frequency: 500};
        watchID = navigator.accelerometer.watchAcceleration(onSuccess, onError, options);
        }


        //wait for PhoneGap to load
        //document.addEventListener("deviceready", onDeviceReady, false);

        function onError() {
        alert('onError!');
        }

        //document.addEventListener("deviceready",onDeviceReady,false);

        //function onDeviceReady()
        //{
        // document.getElementById("welcomeMsg").innerHTML += "PhoneGap is ready! version=" + window.device.phonegap;
        // console.log("onDeviceReady. You should see this message in Visual Studio's output window.");
        //}

        function countUp() {
        document.getElementById('count_up').innerHTML = f;
        f = f+1;
        g = setTimeout("countUp()",1000);
        }

        function timedCount() {
        document.getElementById('timer').innerHTML = (5-c);
        c = c+1;
        if (c != 6) {
        t = setTimeout("timedCount()",1000);
        } else {
        countUp();
        startWatch();
        }
        }

        function startTimer() {
        if (!timer_is_on) {
        timer_is_on = 1;
        timedCount();
        }
        }

        function stopCount() {
        clearTimeout(g);
        }


      </script>
      
	 
	  

  </head>
  <body>
    <h1>Battle!</h1>

    <table id="com_table">
      <tr>
        <td>
          MOBILE
        </td>
        <td>
          KOMBAT
        </td>
      </tr>
    </table>
    Flip over your phones!  The game will start in:
    <span type ="text" id ="timer"> </span>
    <!--<input type ="text" id ="timer" />-->


    <!--<button id="fight_button" onclick="startTimer()">Fight!</button>-->
    <br/><br/><br/>
    Timer:
    <span type ="text" id ="count_up"> </span>
    <!--<input type ="text" id ="count_up" />-->
    <!--<div id="welcomeMsg"></div>-->

    <div id="accelerometer">Waiting for accelerometer...</div>
    <input type ="text" id ="valueX" /> <br/>
    <input type ="text" id ="valueY" /> <br/>
    <input type ="text" id ="valueZ" />

    <script>
      window.onload = startTimer();
    </script>
  </body>
</html>
